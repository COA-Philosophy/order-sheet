<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¡ã‚¤ãƒ‰ã‚¹ãƒ¼ãƒ„ã€€ã‚ªãƒ¼ãƒ€ãƒ¼ã‚·ãƒ¼ãƒˆ</title>
    
    <style>
/* =====================================
   CRMã‚ªãƒ¼ãƒ€ãƒ¼ã‚·ãƒ¼ãƒˆ å®Œå…¨ç‰ˆCSS
   ===================================== */

/* ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆ */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
    margin: 20px;
    background-color: #f5f5f5;
    line-height: 1.6;
    color: #333;
}

/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
.container {
    max-width: 210mm;
    margin: 0 auto;
    background: white;
    padding: 20px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
    border-radius: 8px;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.header {
    text-align: center;
    margin-bottom: 30px;
    border-bottom: 3px solid #2c3e50;
    padding-bottom: 15px;
}

.header h1 {
    color: #2c3e50;
    font-size: 28px;
    margin: 0;
    letter-spacing: 2px;
}

.header p {
    color: #7f8c8d;
    margin: 5px 0 0 0;
    font-size: 14px;
}

/* ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…±é€š */
.section {
    margin-bottom: 25px;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    overflow: hidden;
}

.section-title {
    background: linear-gradient(135deg, #34495e, #2c3e50);
    color: white;
    padding: 12px 15px;
    margin: 0;
    font-size: 16px;
    font-weight: bold;
}

.section-content {
    padding: 20px;
}

/* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
.form-row {
    display: flex;
    margin-bottom: 15px;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.form-group {
    flex: 1;
    min-width: 200px;
    margin-bottom: 15px;
}

.form-group:last-child {
    margin-right: 0;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #2c3e50;
    font-size: 14px;
}

.required {
    color: #e74c3c;
}

.form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: 10px;
    border: 2px solid #e0e0e0;
    border-radius: 4px;
    font-size: 14px;
    transition: all 0.3s ease;
    box-sizing: border-box;
}

.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
}

/* å¿…é ˆæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
.essential-info {
    border: 3px solid #e74c3c;
    background: linear-gradient(135deg, #fff5f5, #ffffff);
    box-shadow: 0 8px 25px rgba(231, 76, 60, 0.15);
}

.essential-info .section-title {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    font-size: 18px;
    padding: 15px 20px;
}

.input-guide {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 25px;
    color: #495057;
}

.input-guide p {
    margin: 0;
    font-size: 14px;
}

/* å¿…é ˆé …ç›®ã‚°ãƒ«ãƒ¼ãƒ— */
.essential-group {
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    transition: all 0.3s ease;
}

.essential-group:hover {
    border-color: #3498db;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.1);
}

.essential-group.completed {
    border-color: #27ae60;
    background: linear-gradient(135deg, #f8fff8, #ffffff);
}

.essential-header {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #e9ecef;
}

.step-number {
    background: #3498db;
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-right: 15px;
    font-size: 14px;
}

.essential-header h4 {
    flex: 1;
    margin: 0;
    color: #2c3e50;
    font-size: 16px;
}

.check-mark {
    background: #27ae60;
    color: white;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    opacity: 0;
    transition: all 0.3s ease;
}

.check-mark.visible {
    opacity: 1;
    transform: scale(1.1);
}

/* å¤§ããªå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
.large-input input, .large-input select {
    font-size: 16px;
    padding: 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.large-input input:focus, .large-input select:focus {
    border-color: #3498db;
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
    transform: translateY(-2px);
}

.large-input input.valid {
    border-color: #27ae60;
    background: linear-gradient(135deg, #f8fff8, #ffffff);
}

.large-input input.invalid {
    border-color: #e74c3c;
    background: linear-gradient(135deg, #fff5f5, #ffffff);
}

/* åå‰å…¥åŠ›ã‚¨ãƒªã‚¢ */
.name-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.name-kana {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

/* ç”Ÿå¹´æœˆæ—¥å…¥åŠ›ã‚¨ãƒªã‚¢ */
.birth-date-inputs {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 15px;
}

/* ä½æ‰€å…¥åŠ›ã‚¨ãƒªã‚¢ */
.address-inputs .postal-row {
    display: flex;
    gap: 10px;
    align-items: end;
    margin-bottom: 15px;
}

.address-lookup-btn {
    background: #3498db;
    color: white;
    border: none;
    padding: 15px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    white-space: nowrap;
    transition: all 0.3s ease;
}

.address-lookup-btn:hover {
    background: #2980b9;
    transform: translateY(-2px);
}

/* å…¥åŠ›ãƒ’ãƒ³ãƒˆ */
.input-hint {
    font-size: 12px;
    color: #7f8c8d;
    margin-top: 5px;
    font-style: italic;
}

/* é€²æ—ãƒãƒ¼ */
.progress-section {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
    text-align: center;
}

.progress-bar {
    background: #e9ecef;
    height: 8px;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 10px;
}

.progress-fill {
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    height: 100%;
    width: 0%;
    transition: width 0.5s ease;
    border-radius: 4px;
}

.progress-text {
    font-weight: bold;
    color: #2c3e50;
    font-size: 14px;
}

/* å®Œäº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
.essential-group.completed .step-number {
    background: #27ae60;
}

/* æ¡å¯¸ã‚°ãƒªãƒƒãƒ‰ */
.measurement-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 10px;
}

/* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚°ãƒ«ãƒ¼ãƒ— */
.checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-top: 10px;
}

.checkbox-item {
    display: flex;
    align-items: center;
    min-width: 150px;
}

.checkbox-item input[type="checkbox"] {
    width: auto;
    margin-right: 8px;
}

/* ã‚¹ã‚¿ã‚¤ãƒ«ã‚¢ã‚¤ãƒ†ãƒ  */
.style-item {
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    background: #fafafa;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

.style-item:hover {
    border-color: #3498db;
    background: #f8f9fa;
}

.style-item.removing {
    animation: fadeOut 0.3s ease-out forwards;
}

@keyframes fadeOut {
    from {
        opacity: 1;
        max-height: 1000px;
        margin-bottom: 20px;
    }
    to {
        opacity: 0;
        max-height: 0;
        margin-bottom: 0;
        padding: 0;
    }
}

.style-item.adding {
    animation: fadeIn 0.3s ease-out forwards;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        max-height: 0;
        margin-bottom: 0;
        padding: 0;
    }
    to {
        opacity: 1;
        max-height: 1000px;
        margin-bottom: 20px;
        padding: 20px;
    }
}

.item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #e0e0e0;
}

.item-header h5 {
    color: #2c3e50;
    margin: 0;
    font-size: 16px;
    font-weight: bold;
}

.item-count {
    background: #3498db;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 16px;
    font-weight: bold;
    border-radius: 6px;
    margin-bottom: 20px;
}

/* ç·è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.total-section {
    background: #f8f9fa;
    border: 2px solid #3498db;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
}

.total-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    font-size: 16px;
}

.total-row.grand-total {
    font-size: 20px;
    font-weight: bold;
    color: #2c3e50;
    border-top: 2px solid #3498db;
    padding-top: 10px;
    margin-top: 15px;
}

/* ç½²åã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.signature-section {
    margin-top: 30px;
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
}

.signature-box {
    border: 1px solid #ccc;
    width: 200px;
    height: 80px;
    text-align: center;
    padding-top: 50px;
    color: #999;
    margin-bottom: 20px;
}

.notes-area {
    height: 100px;
}

/* ãƒœã‚¿ãƒ³ */
.download-btn {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 25px;
    font-size: 16px;
    cursor: pointer;
    display: block;
    margin: 10px auto;
    transition: all 0.3s ease;
    min-width: 200px;
}

.download-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
}

.save-btn {
    background: linear-gradient(135deg, #27ae60, #2ecc71);
}

.save-btn:hover {
    box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
}

.add-item-btn {
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
}

.add-item-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
}

.remove-item-btn {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
    border: none;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s;
}

.remove-item-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(231, 76, 60, 0.4);
}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
.status-message {
    padding: 15px;
    border-radius: 6px;
    margin: 20px 0;
    text-align: center;
    font-weight: bold;
}

.status-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.status-info {
    background: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

/* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã‚¹ã‚¿ã‚¤ãƒ« */
optgroup {
    font-weight: bold;
    font-style: normal;
    color: #2c3e50;
    background-color: #f8f9fa;
}

optgroup option {
    font-weight: normal;
    color: #333;
    background-color: white;
    padding-left: 20px;
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
@keyframes checkmark {
    0% {
        opacity: 0;
        transform: scale(0.5);
    }
    50% {
        transform: scale(1.2);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

.check-mark.visible {
    animation: checkmark 0.5s ease;
}

/* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
@media (max-width: 768px) {
    body {
        margin: 10px;
    }
    
    .container {
        padding: 15px;
    }
    
    .header h1 {
        font-size: 22px;
    }
    
    .form-row {
        flex-direction: column;
        gap: 0;
    }
    
    .form-group {
        margin-right: 0;
        margin-bottom: 15px;
        min-width: auto;
    }
    
    .measurement-grid {
        grid-template-columns: 1fr;
    }
    
    .checkbox-group {
        flex-direction: column;
        gap: 10px;
    }
    
    .checkbox-item {
        min-width: auto;
    }
    
    .signature-section {
        flex-direction: column;
    }
    
    .signature-box {
        width: 100%;
        margin-bottom: 15px;
    }
    
    .name-inputs, .name-kana {
        grid-template-columns: 1fr;
    }
    
    .birth-date-inputs {
        grid-template-columns: 1fr;
    }
    
    .address-inputs .postal-row {
        flex-direction: column;
        gap: 15px;
    }
    
    .essential-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .step-number {
        align-self: flex-start;
    }
    
    .download-btn {
        min-width: auto;
        width: 100%;
    }
}

/* å°åˆ·å¯¾å¿œ */
@media print {
    body { 
        margin: 0; 
        background: white; 
    }
    
    .container { 
        box-shadow: none; 
        margin: 0; 
        max-width: none; 
    }
    
    .download-btn { 
        display: none; 
    }
    
    .add-item-btn, .remove-item-btn { 
        display: none; 
    }
    
    .status-message { 
        display: none; 
    }
    
    .essential-info {
        border-color: #ccc;
        background: white;
    }
    
    .progress-section {
        display: none;
    }
    
    .save-section {
        display: none;
    }
}

/* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¼·åŒ– */
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    border-width: 3px;
}

/* ç„¡åŠ¹çŠ¶æ…‹ */
.form-group input:disabled,
.form-group select:disabled,
.form-group textarea:disabled {
    background-color: #f8f9fa;
    color: #6c757d;
    cursor: not-allowed;
}

/* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ */
.form-group input::placeholder,
.form-group textarea::placeholder {
    color: #adb5bd;
    font-style: italic;
}

/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ï¼ˆWebkitç³»ãƒ–ãƒ©ã‚¦ã‚¶ï¼‰ */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®è¦‹ãŸç›®å‘ä¸Š */
select {
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 20px;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
}

/* ä¿å­˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.save-section {
    margin-top: 30px;
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
}

.save-section h3 {
    margin-bottom: 20px;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¡ã‚¤ãƒ‰ã‚¹ãƒ¼ãƒ„ ã‚ªãƒ¼ãƒ€ãƒ¼ã‚·ãƒ¼ãƒˆ</h1>
            <p>Order Date: <span id="currentDate"></span> | Order No: <span id="orderNumber"></span></p>
        </div>

        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
        <div id="statusMessage" style="display: none;"></div>

        <!-- å¿…é ˆæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé¡§å®¢å…¥åŠ›ç”¨ï¼‰ -->
        <div class="section essential-info">
            <h2 class="section-title">âœ¨ å¿…é ˆæƒ…å ±ã®å…¥åŠ›ï¼ˆãŠå®¢æ§˜ã”è¨˜å…¥ãã ã•ã„ï¼‰</h2>
            <div class="section-content">
                <div class="input-guide">
                    <p>ğŸ“ ä»¥ä¸‹ã®4é …ç›®ã®ã”å…¥åŠ›ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚å…¥åŠ›å®Œäº†ã§ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                </div>
                
                <!-- ãŠåå‰ -->
                <div class="essential-group">
                    <div class="essential-header">
                        <span class="step-number">1</span>
                        <h4>ãŠåå‰</h4>
                        <span class="check-mark" id="nameCheck">âœ“</span>
                    </div>
                    <div class="name-inputs">
                        <div class="form-group large-input">
                            <label for="lastName">å§“</label>
                            <input type="text" id="lastName" name="lastName" placeholder="å±±ç”°" required autocomplete="family-name">
                        </div>
                        <div class="form-group large-input">
                            <label for="firstName">å</label>
                            <input type="text" id="firstName" name="firstName" placeholder="å¤ªéƒ" required autocomplete="given-name">
                        </div>
                    </div>
                    <div class="name-kana">
                        <div class="form-group">
                            <label for="lastNameKana">ãƒ•ãƒªã‚¬ãƒŠï¼ˆã‚»ã‚¤ï¼‰</label>
                            <input type="text" id="lastNameKana" name="lastNameKana" placeholder="ãƒ¤ãƒãƒ€" autocomplete="family-name">
                        </div>
                        <div class="form-group">
                            <label for="firstNameKana">ãƒ•ãƒªã‚¬ãƒŠï¼ˆãƒ¡ã‚¤ï¼‰</label>
                            <input type="text" id="firstNameKana" name="firstNameKana" placeholder="ã‚¿ãƒ­ã‚¦" autocomplete="given-name">
                        </div>
                    </div>
                </div>

                <!-- é›»è©±ç•ªå· -->
                <div class="essential-group">
                    <div class="essential-header">
                        <span class="step-number">2</span>
                        <h4>é›»è©±ç•ªå·</h4>
                        <span class="check-mark" id="phoneCheck">âœ“</span>
                    </div>
                    <div class="form-group large-input">
                        <label for="phone">æºå¸¯é›»è©±ã¾ãŸã¯å›ºå®šé›»è©±</label>
                        <input type="tel" id="phone" name="phone" placeholder="090-1234-5678" required autocomplete="tel">
                        <div class="input-hint">ãƒã‚¤ãƒ•ãƒ³ï¼ˆ-ï¼‰ã‚ã‚Šã§ã‚‚ã€ãªã—ã§ã‚‚OKã§ã™</div>
                    </div>
                </div>

                <!-- ç”Ÿå¹´æœˆæ—¥ -->
                <div class="essential-group">
                    <div class="essential-header">
                        <span class="step-number">3</span>
                        <h4>ç”Ÿå¹´æœˆæ—¥</h4>
                        <span class="check-mark" id="birthCheck">âœ“</span>
                    </div>
                    <div class="birth-date-inputs">
                        <div class="form-group">
                            <label for="birthYear">å¹´</label>
                            <select id="birthYear" name="birthYear" required>
                                <option value="">----</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="birthMonth">æœˆ</label>
                            <select id="birthMonth" name="birthMonth" required>
                                <option value="">--</option>
                                <option value="1">1æœˆ</option>
                                <option value="2">2æœˆ</option>
                                <option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option>
                                <option value="5">5æœˆ</option>
                                <option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option>
                                <option value="8">8æœˆ</option>
                                <option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12">12æœˆ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="birthDay">æ—¥</label>
                            <select id="birthDay" name="birthDay" required>
                                <option value="">--</option>
                            </select>
                        </div>
                        <input type="hidden" id="birthDate" name="birthDate">
                    </div>
                </div>

                <!-- ä½æ‰€ -->
                <div class="essential-group">
                    <div class="essential-header">
                        <span class="step-number">4</span>
                        <h4>ã”ä½æ‰€</h4>
                        <span class="check-mark" id="addressCheck">âœ“</span>
                    </div>
                    <div class="address-inputs">
                        <div class="postal-row">
                            <div class="form-group">
                                <label for="postalCode">éƒµä¾¿ç•ªå·</label>
                                <input type="text" id="postalCode" name="postalCode" placeholder="123-4567" autocomplete="postal-code">
                            </div>
                            <button type="button" class="address-lookup-btn" onclick="lookupAddress()">ä½æ‰€æ¤œç´¢</button>
                        </div>
                        <div class="form-group">
                            <label for="prefecture">éƒ½é“åºœçœŒ</label>
                            <select id="prefecture" name="prefecture" autocomplete="address-level1">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="åŒ—æµ·é“">åŒ—æµ·é“</option>
                                <option value="é’æ£®çœŒ">é’æ£®çœŒ</option>
                                <option value="å²©æ‰‹çœŒ">å²©æ‰‹çœŒ</option>
                                <option value="å®®åŸçœŒ">å®®åŸçœŒ</option>
                                <option value="ç§‹ç”°çœŒ">ç§‹ç”°çœŒ</option>
                                <option value="å±±å½¢çœŒ">å±±å½¢çœŒ</option>
                                <option value="ç¦å³¶çœŒ">ç¦å³¶çœŒ</option>
                                <option value="èŒ¨åŸçœŒ">èŒ¨åŸçœŒ</option>
                                <option value="æ ƒæœ¨çœŒ">æ ƒæœ¨çœŒ</option>
                                <option value="ç¾¤é¦¬çœŒ">ç¾¤é¦¬çœŒ</option>
                                <option value="åŸ¼ç‰çœŒ">åŸ¼ç‰çœŒ</option>
                                <option value="åƒè‘‰çœŒ">åƒè‘‰çœŒ</option>
                                <option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option>
                                <option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option>
                                <option value="æ–°æ½ŸçœŒ">æ–°æ½ŸçœŒ</option>
                                <option value="å¯Œå±±çœŒ">å¯Œå±±çœŒ</option>
                                <option value="çŸ³å·çœŒ">çŸ³å·çœŒ</option>
                                <option value="ç¦äº•çœŒ">ç¦äº•çœŒ</option>
                                <option value="å±±æ¢¨çœŒ">å±±æ¢¨çœŒ</option>
                                <option value="é•·é‡çœŒ">é•·é‡çœŒ</option>
                                <option value="å²é˜œçœŒ">å²é˜œçœŒ</option>
                                <option value="é™å²¡çœŒ">é™å²¡çœŒ</option>
                                <option value="æ„›çŸ¥çœŒ">æ„›çŸ¥çœŒ</option>
                                <option value="ä¸‰é‡çœŒ">ä¸‰é‡çœŒ</option>
                                <option value="æ»‹è³€çœŒ">æ»‹è³€çœŒ</option>
                                <option value="äº¬éƒ½åºœ">äº¬éƒ½åºœ</option>
                                <option value="å¤§é˜ªåºœ">å¤§é˜ªåºœ</option>
                                <option value="å…µåº«çœŒ">å…µåº«çœŒ</option>
                                <option value="å¥ˆè‰¯çœŒ">å¥ˆè‰¯çœŒ</option>
                                <option value="å’Œæ­Œå±±çœŒ">å’Œæ­Œå±±çœŒ</option>
                                <option value="é³¥å–çœŒ">é³¥å–çœŒ</option>
                                <option value="å³¶æ ¹çœŒ">å³¶æ ¹çœŒ</option>
                                <option value="å²¡å±±çœŒ">å²¡å±±çœŒ</option>
                                <option value="åºƒå³¶çœŒ">åºƒå³¶çœŒ</option>
                                <option value="å±±å£çœŒ">å±±å£çœŒ</option>
                                <option value="å¾³å³¶çœŒ">å¾³å³¶çœŒ</option>
                                <option value="é¦™å·çœŒ">é¦™å·çœŒ</option>
                                <option value="æ„›åª›çœŒ">æ„›åª›çœŒ</option>
                                <option value="é«˜çŸ¥çœŒ">é«˜çŸ¥çœŒ</option>
                                <option value="ç¦å²¡çœŒ">ç¦å²¡çœŒ</option>
                                <option value="ä½è³€çœŒ">ä½è³€çœŒ</option>
                                <option value="é•·å´çœŒ">é•·å´çœŒ</option>
                                <option value="ç†Šæœ¬çœŒ">ç†Šæœ¬çœŒ</option>
                                <option value="å¤§åˆ†çœŒ">å¤§åˆ†çœŒ</option>
                                <option value="å®®å´çœŒ">å®®å´çœŒ</option>
                                <option value="é¹¿å…å³¶çœŒ">é¹¿å…å³¶çœŒ</option>
                                <option value="æ²–ç¸„çœŒ">æ²–ç¸„çœŒ</option>
                            </select>
                        </div>
                        <div class="form-group large-input">
                            <label for="address">å¸‚åŒºç”ºæ‘ãƒ»ç•ªåœ°ãƒ»å»ºç‰©å</label>
                            <input type="text" id="address" name="address" placeholder="æ¸‹è°·åŒºæµæ¯”å¯¿1-2-3 æµæ¯”å¯¿ãƒ“ãƒ«101å·" required autocomplete="address-line1">
                        </div>
                    </div>
                </div>

                <!-- å…¥åŠ›é€²æ— -->
                <div class="progress-section">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text">å…¥åŠ›å®Œäº†: <span id="progressText">0/4</span></div>
                </div>
            </div>
        </div>

        <!-- ä»»æ„æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <h2 class="section-title">ğŸ“‹ è¿½åŠ æƒ…å ±ï¼ˆä»»æ„ï¼‰</h2>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                        <input type="email" id="email" name="email" placeholder="example@email.com" autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label for="lineId">LINE ID</label>
                        <input type="text" id="lineId" name="lineId" placeholder="@your_line_id">
                    </div>
                    <div class="form-group">
                        <label for="referrer">ã”ç´¹ä»‹è€…æ§˜</label>
                        <input type="text" id="referrer" name="referrer" placeholder="ã”ç´¹ä»‹ã„ãŸã ã„ãŸæ–¹ã®ãŠåå‰">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="gender">æ€§åˆ¥ï¼ˆä»»æ„ï¼‰</label>
                        <select id="gender" name="gender">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="male">ç”·æ€§</option>
                            <option value="female">å¥³æ€§</option>
                            <option value="other">ãã®ä»–</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="occupation">è·æ¥­ï¼ˆä»»æ„ï¼‰</label>
                        <input type="text" id="occupation" name="occupation" placeholder="ä¾‹ï¼šä¼šç¤¾å“¡ã€çµŒå–¶è€…ã€è‡ªå–¶æ¥­">
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¡å¯¸æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <h2 class="section-title">ğŸ“ æ¡å¯¸æƒ…å ±</h2>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="height">èº«é•·ï¼ˆcmï¼‰</label>
                        <input type="number" id="height" name="height" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="weight">ä½“é‡ï¼ˆkgï¼‰</label>
                        <input type="number" id="weight" name="weight" step="0.1">
                    </div>
                </div>
                
                <!-- åŸºæœ¬æ¡å¯¸ -->
                <h4 style="color: #2c3e50; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 1px solid #e0e0e0;">åŸºæœ¬æ¡å¯¸</h4>
                <div class="measurement-grid">
                    <div class="form-group">
                        <label for="chest">èƒ¸å›²ï¼ˆcmï¼‰</label>
                        <input type="number" id="chest" name="chest" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="waist">ã‚¦ã‚¨ã‚¹ãƒˆï¼ˆcmï¼‰</label>
                        <input type="number" id="waist" name="waist" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="hip">ãƒ’ãƒƒãƒ—ï¼ˆcmï¼‰</label>
                        <input type="number" id="hip" name="hip" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="shoulderWidth">è‚©å¹…ï¼ˆcmï¼‰</label>
                        <input type="number" id="shoulderWidth" name="shoulderWidth" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="jacketLength">ä¸Šç€ä¸ˆï¼ˆcmï¼‰</label>
                        <input type="number" id="jacketLength" name="jacketLength" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="neckSize">é¦–å›ã‚Šï¼ˆcmï¼‰</label>
                        <input type="number" id="neckSize" name="neckSize" step="0.1">
                    </div>
                </div>

                <!-- è¢–æ¡å¯¸ -->
                <h4 style="color: #2c3e50; margin: 25px 0 15px 0; padding-bottom: 5px; border-bottom: 1px solid #e0e0e0;">è¢–æ¡å¯¸</h4>
                <div class="measurement-grid">
                    <div class="form-group">
                        <label for="armLengthLeft">è¢–ä¸ˆå·¦ï¼ˆcmï¼‰</label>
                        <input type="number" id="armLengthLeft" name="armLengthLeft" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="armLengthRight">è¢–ä¸ˆå³ï¼ˆcmï¼‰</label>
                        <input type="number" id="armLengthRight" name="armLengthRight" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="yokoLength">è£„ä¸ˆï¼ˆcmï¼‰</label>
                        <input type="number" id="yokoLength" name="yokoLength" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="armHole">AHï¼ˆcmï¼‰</label>
                        <input type="number" id="armHole" name="armHole" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="upperArmCircum">äºŒã®è…•å‘¨ã‚Šï¼ˆcmï¼‰</label>
                        <input type="number" id="upperArmCircum" name="upperArmCircum" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="elbowCircum">è‚˜å‘¨ã‚Šï¼ˆcmï¼‰</label>
                        <input type="number" id="elbowCircum" name="elbowCircum" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="wristCircum">æ‰‹é¦–å‘¨ã‚Šï¼ˆcmï¼‰</label>
                        <input type="number" id="wristCircum" name="wristCircum" step="0.1">
                    </div>
                </div>

                <!-- ãƒ™ã‚¹ãƒˆæ¡å¯¸ -->
                <h4 style="color: #2c3e50; margin: 25px 0 15px 0; padding-bottom: 5px; border-bottom: 1px solid #e0e0e0;">ãƒ™ã‚¹ãƒˆæ¡å¯¸</h4>
                <div class="measurement-grid">
                    <div class="form-group">
                        <label for="vestLength">ãƒ™ã‚¹ãƒˆä¸ˆï¼ˆcmï¼‰</label>
                        <input type="number" id="vestLength" name="vestLength" step="0.1">
                    </div>
                </div>

                <!-- ãƒ‘ãƒ³ãƒ„æ¡å¯¸ -->
                <h4 style="color: #2c3e50; margin: 25px 0 15px 0; padding-bottom: 5px; border-bottom: 1px solid #e0e0e0;">ãƒ‘ãƒ³ãƒ„æ¡å¯¸</h4>
                <div class="measurement-grid">
                    <div class="form-group">
                        <label for="pantWaist">ãƒ‘ãƒ³ãƒ„ã‚¦ã‚¨ã‚¹ãƒˆï¼ˆcmï¼‰</label>
                        <input type="number" id="pantWaist" name="pantWaist" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="crotchDepth">è‚¡ä¸Šï¼ˆcmï¼‰</label>
                        <input type="number" id="crotchDepth" name="crotchDepth" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="inseam">è‚¡ä¸‹ï¼ˆcmï¼‰</label>
                        <input type="number" id="inseam" name="inseam" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="thighCircum">å¤ªã‚‚ã‚‚å‘¨ã‚Šï¼ˆcmï¼‰</label>
                        <input type="number" id="thighCircum" name="thighCircum" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="kneeCircum">è†å‘¨ã‚Šï¼ˆcmï¼‰</label>
                        <input type="number" id="kneeCircum" name="kneeCircum" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="calfCircum">ãµãã‚‰ã¯ãå‘¨ã‚Šï¼ˆcmï¼‰</label>
                        <input type="number" id="calfCircum" name="calfCircum" step="0.1">
                    </div>
                </div>

                <!-- è©³ç´°æ¡å¯¸ -->
                <h4 style="color: #2c3e50; margin: 25px 0 15px 0; padding-bottom: 5px; border-bottom: 1px solid #e0e0e0;">è©³ç´°æ¡å¯¸</h4>
                <div class="measurement-grid">
                    <div class="form-group">
                        <label for="shoulderSlopeLeft">è‚©å‚¾æ–œå·¦ï¼ˆåº¦ï¼‰</label>
                        <input type="number" id="shoulderSlopeLeft" name="shoulderSlopeLeft" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="shoulderSlopeRight">è‚©å‚¾æ–œå³ï¼ˆåº¦ï¼‰</label>
                        <input type="number" id="shoulderSlopeRight" name="shoulderSlopeRight" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="kamaDepth">éŒæ·±ï¼ˆcmï¼‰</label>
                        <input type="number" id="kamaDepth" name="kamaDepth" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="strapLength">ã‚¹ãƒˆãƒ©ãƒƒãƒ—å¯¸ï¼ˆcmï¼‰</label>
                        <input type="number" id="strapLength" name="strapLength" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="overShoulderLength">ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼å¯¸ï¼ˆcmï¼‰</label>
                        <input type="number" id="overShoulderLength" name="overShoulderLength" step="0.1">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="bodyType">ä½“å‹ã®ç‰¹å¾´ãƒ»æ³¨æ„ç‚¹</label>
                    <textarea id="bodyType" name="bodyType" rows="3" placeholder="ãªã§è‚©ã€ã„ã‹ã‚Šè‚©ã€å·¦å³å·®ãªã©"></textarea>
                </div>
            </div>
        </div>

        <!-- ã‚¹ã‚¿ã‚¤ãƒ«ãƒ»ä»•æ§˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <h2 class="section-title">ğŸ‘” ã‚¹ã‚¿ã‚¤ãƒ«ãƒ»ä»•æ§˜</h2>
            <div class="section-content">
                <div class="item-count">
                    ã‚ªãƒ¼ãƒ€ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ æ•°: <span id="itemCount">1</span>ç€
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                    <h4 style="color: #2c3e50; margin: 0;">ã‚ªãƒ¼ãƒ€ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§</h4>
                    <button type="button" class="add-item-btn" onclick="addStyleItem()">+ ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ </button>
                </div>
                
                <div id="styleItemsContainer">
                    <!-- åˆæœŸã‚¢ã‚¤ãƒ†ãƒ  -->
                    <div class="style-item" data-item="1">
                        <div class="item-header">
                            <h5>ã‚¢ã‚¤ãƒ†ãƒ  1</h5>
                            <button type="button" class="remove-item-btn" onclick="removeStyleItem(1)" style="display: none;">å‰Šé™¤</button>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="itemType_1">ã‚¢ã‚¤ãƒ†ãƒ ã‚¿ã‚¤ãƒ—</label>
                                <select id="itemType_1" name="itemType_1">
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    <option value="Suit(2P)">Suit(2P)</option>
                                    <option value="Suit(3P)">Suit(3P)</option>
                                    <option value="Suit+Pants">Suit+Pants</option>
                                    <option value="Suit(3P)+Pants">Suit(3P)+Pants</option>
                                    <option value="Jacket(S)">Jacket(S)</option>
                                    <option value="Jacket(D)">Jacket(D)</option>
                                    <option value="Vest">Vest</option>
                                    <option value="Pants">Pants</option>
                                    <option value="D Suit">D Suit</option>
                                    <option value="D Suit(3P)">D Suit(3P)</option>
                                    <option value="D Suit+Pants">D Suit+Pants</option>
                                    <option value="D Suit(3P)+Pants">D Suit(3P)+Pants</option>
                                    <option value="Shirts">Shirts</option>
                                    <option value="Tie">Tie</option>
                                    <option value="Repair">Repair</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="fabric_1">ç”Ÿåœ°</label>
                                <input type="text" id="fabric_1" name="fabric_1" placeholder="ç”Ÿåœ°ç•ªå·ãƒ»åç§°">
                            </div>
                            <div class="form-group">
                                <label for="color_1">è‰²</label>
                                <input type="text" id="color_1" name="color_1">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jacketStyle_1">ã‚¸ãƒ£ã‚±ãƒƒãƒˆã‚¹ã‚¿ã‚¤ãƒ«</label>
                                <select id="jacketStyle_1" name="jacketStyle_1">
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    <option value="single">ã‚·ãƒ³ã‚°ãƒ«</option>
                                    <option value="double">ãƒ€ãƒ–ãƒ«</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="lining_1">è£åœ°</label>
                                <input type="text" id="lining_1" name="lining_1" placeholder="è£åœ°ã®ç¨®é¡ãƒ»è‰²">
                            </div>
                            <div class="form-group">
                                <label for="buttons_1">ãƒœã‚¿ãƒ³</label>
                                <input type="text" id="buttons_1" name="buttons_1" placeholder="ãƒœã‚¿ãƒ³ã®ç¨®é¡ãƒ»æè³ª">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lapelStyle_1">è¡¿å‹ï¼ˆãƒ©ãƒšãƒ«ãƒ»ã‚«ãƒ©ãƒ¼ï¼‰</label>
                                <select id="lapelStyle_1" name="lapelStyle_1">
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    <optgroup label="ã‚¸ãƒ£ã‚±ãƒƒãƒˆãƒ»ã‚¹ãƒ¼ãƒ„">
                                        <option value="notched">ãƒãƒƒãƒãƒ‰ãƒ©ãƒšãƒ«ï¼ˆä¸€èˆ¬çš„ï¼‰</option>
                                        <option value="peaked">ãƒ”ãƒ¼ã‚¯ãƒ‰ãƒ©ãƒšãƒ«ï¼ˆå‰£å…ˆï¼‰</option>
                                        <option value="shawl">ã‚·ãƒ§ãƒ¼ãƒ«ã‚«ãƒ©ãƒ¼</option>
                                        <option value="narrow">ãƒŠãƒ­ãƒ¼ãƒ©ãƒšãƒ«</option>
                                        <option value="wide">ãƒ¯ã‚¤ãƒ‰ãƒ©ãƒšãƒ«</option>
                                    </optgroup>
                                    <optgroup label="ã‚·ãƒ£ãƒ„ã‚«ãƒ©ãƒ¼">
                                        <option value="regular_collar">ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ã‚«ãƒ©ãƒ¼</option>
                                        <option value="semi_wide_collar">ã‚»ãƒŸãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                                        <option value="wide_collar">ãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                                        <option value="horizontal_wide_collar">ãƒ›ãƒªã‚¾ãƒ³ã‚¿ãƒ«ãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                                        <option value="round_collar">ãƒ©ã‚¦ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                                        <option value="open_collar">ã‚ªãƒ¼ãƒ—ãƒ³ã‚«ãƒ©ãƒ¼</option>
                                        <option value="stand_collar">ã‚¹ã‚¿ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                                        <option value="wing_collar">ã‚¦ã‚£ãƒ³ã‚°ã‚«ãƒ©ãƒ¼</option>
                                        <option value="short_regular_collar">ã‚·ãƒ§ãƒ¼ãƒˆãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ã‚«ãƒ©ãƒ¼</option>
                                        <option value="short_semi_wide_collar">ã‚·ãƒ§ãƒ¼ãƒˆã‚»ãƒŸãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                                        <option value="short_wide_collar">ã‚·ãƒ§ãƒ¼ãƒˆãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                                        <option value="short_horizontal_wide_collar">ã‚·ãƒ§ãƒ¼ãƒˆãƒ›ãƒªã‚¾ãƒ³ã‚¿ãƒ«ãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                                        <option value="short_round_collar">ã‚·ãƒ§ãƒ¼ãƒˆãƒ©ã‚¦ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cuffStyle_1">ã‚«ãƒ•ã‚¹ï¼ˆè¢–å£ï¼‰</label>
                                <select id="cuffStyle_1" name="cuffStyle_1">
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    <optgroup label="ã‚¸ãƒ£ã‚±ãƒƒãƒˆãƒ»ã‚¹ãƒ¼ãƒ„">
                                        <option value="4button">4ã¤ãƒœã‚¿ãƒ³æœ¬åˆ‡ç¾½</option>
                                        <option value="3button">3ã¤ãƒœã‚¿ãƒ³æœ¬åˆ‡ç¾½</option>
                                        <option value="4button_fake">4ã¤ãƒœã‚¿ãƒ³ï¼ˆé£¾ã‚Šï¼‰</option>
                                        <option value="3button_fake">3ã¤ãƒœã‚¿ãƒ³ï¼ˆé£¾ã‚Šï¼‰</option>
                                        <option value="surgeons">ã‚µãƒ¼ã‚¸ãƒ£ãƒ³ã‚«ãƒ•ã‚¹</option>
                                        <option value="kissing">ã‚­ãƒƒã‚·ãƒ³ã‚°ãƒœã‚¿ãƒ³</option>
                                    </optgroup>
                                    <optgroup label="ã‚·ãƒ£ãƒ„ã‚«ãƒ•ã‚¹">
                                        <option value="regular_no_opening">ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ï¼ˆé–‹ããªã—ï¼‰</option>
                                        <option value="small_round">å°ä¸¸</option>
                                        <option value="round_b">ãƒ©ã‚¦ãƒ³ãƒ‰B</option>
                                        <option value="round_c">ãƒ©ã‚¦ãƒ³ãƒ‰C</option>
                                        <option value="cut_corner">è§’è½ã¡</option>
                                        <option value="corn">ã‚³ãƒ¼ãƒ³</option>
                                        <option value="turn_up">ã‚¿ãƒ¼ãƒ³ãƒŠãƒƒãƒ—</option>
                                        <option value="double_cuff">ãƒ€ãƒ–ãƒ«</option>
                                        <option value="arrow">ã‚¢ãƒ­ãƒ¼</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cuffDetails_1">ã‚«ãƒ•ã‚¹è©³ç´°</label>
                                <input type="text" id="cuffDetails_1" name="cuffDetails_1" placeholder="ãƒœã‚¿ãƒ³ãƒ›ãƒ¼ãƒ«è‰²ã€ã‚¹ãƒ†ãƒƒãƒç­‰">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>ã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="ticket_pocket_1" name="options_1">
                                    <label for="ticket_pocket_1">ãƒã‚±ãƒƒãƒˆãƒã‚±ãƒƒãƒˆ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="amf_stitch_1" name="options_1">
                                    <label for="amf_stitch_1">AMFã‚¹ãƒ†ãƒƒãƒ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="functional_sleeves_1" name="options_1">
                                    <label for="functional_sleeves_1">æœ¬åˆ‡ç¾½</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="side_vents_1" name="options_1">
                                    <label for="side_vents_1">ã‚µã‚¤ãƒ‰ãƒ™ãƒ³ãƒ„</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="suspender_buttons_1" name="options_1">
                                    <label for="suspender_buttons_1">ã‚µã‚¹ãƒšãƒ³ãƒ€ãƒ¼ãƒœã‚¿ãƒ³</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="center_vent_1" name="options_1">
                                    <label for="center_vent_1">ã‚»ãƒ³ã‚¿ãƒ¼ãƒ™ãƒ³ãƒ„</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="price_1">ä¾¡æ ¼ï¼ˆå††ï¼‰</label>
                                <input type="number" id="price_1" name="price_1" step="1000" onchange="updateTotalPrice()">
                            </div>
                            <div class="form-group">
                                <label for="deliveryDate_1">ç´æœŸ</label>
                                <input type="date" id="deliveryDate_1" name="deliveryDate_1">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="notes_1">å‚™è€ƒ</label>
                            <textarea id="notes_1" name="notes_1" rows="2" placeholder="ç‰¹åˆ¥ãªè¦æœ›ã‚„æ³¨æ„äº‹é …"></textarea>
                        </div>
                    </div>
                </div>

                <!-- ç·è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="total-section">
                    <h4 style="color: #2c3e50; margin: 0 0 15px 0;">ä¾¡æ ¼ç·è¨ˆ</h4>
                    <div id="priceBreakdown"></div>
                    <div class="total-row grand-total">
                        <span>ç·è¨ˆ</span>
                        <span id="grandTotal">Â¥0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãŠæ”¯æ‰•ã„ãƒ»ç´æœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <h2 class="section-title">ğŸ’° ãŠæ”¯æ‰•ã„ãƒ»ç´æœŸ</h2>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="paymentMethod">ãŠæ”¯æ‰•ã„æ–¹æ³•</label>
                        <select id="paymentMethod" name="paymentMethod">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="cash">ç¾é‡‘</option>
                            <option value="card">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰</option>
                            <option value="transfer">éŠ€è¡ŒæŒ¯è¾¼</option>
                            <option value="installment">åˆ†å‰²æ‰•ã„</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="deposit">å†…é‡‘ï¼ˆå††ï¼‰</label>
                        <input type="number" id="deposit" name="deposit" step="1000">
                    </div>
                    <div class="form-group">
                        <label for="balance">æ®‹é‡‘ï¼ˆå††ï¼‰</label>
                        <input type="number" id="balance" name="balance" step="1000">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="orderDate">å—æ³¨æ—¥</label>
                        <input type="date" id="orderDate" name="orderDate">
                    </div>
                    <div class="form-group">
                        <label for="fittingDate">ä¸­ç¸«ã„æ—¥</label>
                        <input type="date" id="fittingDate" name="fittingDate">
                    </div>
                    <div class="form-group">
                        <label for="completionDate">ä»•ä¸ŠãŒã‚Šäºˆå®šæ—¥</label>
                        <input type="date" id="completionDate" name="completionDate">
                    </div>
                </div>
            </div>
        </div>

        <!-- å‚™è€ƒãƒ»ãã®ä»–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <h2 class="section-title">ğŸ“ å‚™è€ƒãƒ»ãã®ä»–</h2>
            <div class="section-content">
                <div class="form-group">
                    <label for="generalNotes">å…¨èˆ¬å‚™è€ƒ</label>
                    <textarea id="generalNotes" name="generalNotes" class="notes-area" placeholder="ç‰¹åˆ¥ãªè¦æœ›ã€æ³¨æ„äº‹é …ã€ãã®ä»–"></textarea>
                </div>
                
                <div class="signature-section">
                    <div>
                        <p style="margin-bottom: 10px; font-weight: bold;">ãŠå®¢æ§˜ã‚µã‚¤ãƒ³</p>
                        <div class="signature-box">ãŠå®¢æ§˜ç½²åæ¬„</div>
                    </div>
                    <div>
                        <p style="margin-bottom: 10px; font-weight: bold;">æ‹…å½“è€…ã‚µã‚¤ãƒ³</p>
                        <div class="signature-box">æ‹…å½“è€…ç½²åæ¬„</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¿å­˜ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
        <div class="save-section">
            <h3 style="text-align: center; color: #2c3e50; margin: 20px 0;">ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³</h3>
            
            <!-- ãƒ¡ã‚¤ãƒ³ä¿å­˜ãƒœã‚¿ãƒ³ -->
            <button type="button" class="download-btn save-btn" onclick="saveToPDF()">ğŸ“„ PDFä¿å­˜ï¼ˆãŠã™ã™ã‚ï¼‰</button>
            <button type="button" class="download-btn" onclick="saveToExcel()">ğŸ“Š Excelä¿å­˜ï¼ˆç·¨é›†å¯èƒ½ï¼‰</button>
            <button type="button" class="download-btn" onclick="saveToCSV()">ğŸ“Š CSVä¿å­˜ï¼ˆãƒ‡ãƒ¼ã‚¿ç®¡ç†ç”¨ï¼‰</button>
            
            <!-- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨ -->
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                <p style="text-align: center; color: #7f8c8d; font-size: 14px; margin-bottom: 10px;">ãã®ä»–ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³</p>
                <button type="button" class="download-btn" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·ãƒ»PDFå‡ºåŠ›</button>
                <button type="button" class="download-btn" onclick="saveBackupData()">ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿å­˜</button>
                <button type="button" class="download-btn" onclick="loadBackupData()">ğŸ“‚ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—èª­è¾¼</button>
            </div>
        </div>
    </div>

    <script>
// =====================================
// CRMã‚ªãƒ¼ãƒ€ãƒ¼ã‚·ãƒ¼ãƒˆ å®Œå…¨ç‰ˆJavaScript
// è¡¿å‹ãƒ»ã‚«ãƒ•ã‚¹å…¨é¸æŠè‚¢å¯¾å¿œç‰ˆ
// =====================================

// åŸºæœ¬è¨­å®šã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
const CRM_API_URL = 'https://script.google.com/macros/s/AKfycbxxap6gn_T7T5rRnCGfACRtQC6tXtSfNjWPtZ2ip4bftZ8JoR11un2u04mdSEpIHNDiHg/exec';
let itemCounter = 1;
let nextItemId = 2;

// =============================================================================
// ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
// =============================================================================

document.addEventListener('DOMContentLoaded', function() {
    console.log('CRMã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...');
    console.log('API URL:', CRM_API_URL);
    
    // ç¾åœ¨ã®æ—¥ä»˜ã¨æ³¨æ–‡ç•ªå·ã‚’è¨­å®š
    const now = new Date();
    const dateStr = now.getFullYear() + '/' + 
                   String(now.getMonth() + 1).padStart(2, '0') + '/' + 
                   String(now.getDate()).padStart(2, '0');
    
    const currentDateElement = document.getElementById('currentDate');
    if (currentDateElement) {
        currentDateElement.textContent = dateStr;
    }
    
    const orderNo = 'ORD' + now.getFullYear() + 
                   String(now.getMonth() + 1).padStart(2, '0') + 
                   String(now.getDate()).padStart(2, '0') + 
                   String(Math.floor(Math.random() * 1000)).padStart(3, '0');
    
    const orderNumberElement = document.getElementById('orderNumber');
    if (orderNumberElement) {
        orderNumberElement.textContent = orderNo;
    }

    // å¿…é ˆé …ç›®æ©Ÿèƒ½ã®åˆæœŸåŒ–
    initializeBirthDateDropdowns();
    setupRealTimeValidation();
    setupKanaAutoGeneration();
    
    // åŸºæœ¬æ©Ÿèƒ½ã®åˆæœŸåŒ–
    updateItemCount();
    updateRemoveButtons();
    updateTotalPrice();
    checkEssentialFields();
    
    // è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é–‹å§‹ï¼ˆlocalStorageåˆ©ç”¨å¯èƒ½ãªå ´åˆã®ã¿ï¼‰
    if (typeof(Storage) !== "undefined" && !isInSandbox()) {
        setupAutoBackup();
        
        // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒã‚ã‚‹å ´åˆã¯é€šçŸ¥
        try {
            const backupData = localStorage.getItem('orderSheetBackup');
            if (backupData) {
                const backupDate = localStorage.getItem('orderSheetBackupDate');
                const date = new Date(backupDate);
                const dateStr = date.toLocaleString('ja-JP');
                
                setTimeout(() => {
                    if (confirm(`å‰å›ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ï¼ˆ${dateStr}ï¼‰ã€‚\nèª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ`)) {
                        loadBackupData();
                    }
                }, 1000);
            }
        } catch (e) {
            console.log('localStorage is not available in this environment');
        }
    }
    
    showStatusMessage('ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸã€‚', 'info');
    console.log('åˆæœŸåŒ–å®Œäº†');
});

// =============================================================================
// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ©Ÿèƒ½
// =============================================================================

function showStatusMessage(message, type = 'info') {
    const statusDiv = document.getElementById('statusMessage');
    if (statusDiv) {
        statusDiv.className = `status-message status-${type}`;
        statusDiv.textContent = message;
        statusDiv.style.display = 'block';
        
        setTimeout(() => {
            statusDiv.style.display = 'none';
        }, 5000);
    } else {
        alert(`${type.toUpperCase()}: ${message}`);
    }
}

// =============================================================================
// å¿…é ˆé …ç›®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
// =============================================================================

function initializeBirthDateDropdowns() {
    const yearSelect = document.getElementById('birthYear');
    const daySelect = document.getElementById('birthDay');
    
    if (!yearSelect || !daySelect) {
        console.error('ç”Ÿå¹´æœˆæ—¥ã®ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
    }
    
    // å¹´ã®é¸æŠè‚¢ã‚’ç”Ÿæˆ
    yearSelect.innerHTML = '<option value="">----</option>';
    const currentYear = new Date().getFullYear();
    for (let year = currentYear; year >= 1920; year--) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year + 'å¹´';
        yearSelect.appendChild(option);
    }
    
    // æ—¥ã®åˆæœŸé¸æŠè‚¢ã‚’ç”Ÿæˆï¼ˆ1-31ï¼‰
    daySelect.innerHTML = '<option value="">--</option>';
    for (let day = 1; day <= 31; day++) {
        const option = document.createElement('option');
        option.value = day;
        option.textContent = day + 'æ—¥';
        daySelect.appendChild(option);
    }
    
    const monthSelect = document.getElementById('birthMonth');
    if (monthSelect) {
        monthSelect.addEventListener('change', updateDays);
    }
    if (yearSelect) {
        yearSelect.addEventListener('change', updateDays);
    }
}

function updateDays() {
    const yearSelect = document.getElementById('birthYear');
    const monthSelect = document.getElementById('birthMonth');
    const daySelect = document.getElementById('birthDay');
    
    if (!yearSelect || !monthSelect || !daySelect) return;
    
    const year = parseInt(yearSelect.value);
    const month = parseInt(monthSelect.value);
    
    daySelect.innerHTML = '<option value="">--</option>';
    
    if (year && month) {
        const daysInMonth = new Date(year, month, 0).getDate();
        
        for (let day = 1; day <= daysInMonth; day++) {
            const option = document.createElement('option');
            option.value = day;
            option.textContent = day + 'æ—¥';
            daySelect.appendChild(option);
        }
    }
    
    updateBirthDateField();
}

function updateBirthDateField() {
    const year = document.getElementById('birthYear')?.value;
    const month = document.getElementById('birthMonth')?.value;
    const day = document.getElementById('birthDay')?.value;
    const birthDateField = document.getElementById('birthDate');
    
    if (year && month && day && birthDateField) {
        const formattedDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
        birthDateField.value = formattedDate;
    }
    
    checkEssentialFields();
}

function setupRealTimeValidation() {
    const lastNameField = document.getElementById('lastName');
    const firstNameField = document.getElementById('firstName');
    
    if (lastNameField) {
        lastNameField.addEventListener('input', function() {
            validateField(this, 'nameCheck');
        });
    }
    
    if (firstNameField) {
        firstNameField.addEventListener('input', function() {
            validateField(this, 'nameCheck');
        });
    }
    
    const phoneField = document.getElementById('phone');
    if (phoneField) {
        phoneField.addEventListener('input', function() {
            validatePhoneNumber(this);
        });
    }
    
    const birthYearField = document.getElementById('birthYear');
    const birthMonthField = document.getElementById('birthMonth');
    const birthDayField = document.getElementById('birthDay');
    
    if (birthYearField) birthYearField.addEventListener('change', updateBirthDateField);
    if (birthMonthField) birthMonthField.addEventListener('change', updateBirthDateField);
    if (birthDayField) birthDayField.addEventListener('change', updateBirthDateField);
    
    const addressField = document.getElementById('address');
    const prefectureField = document.getElementById('prefecture');
    
    if (addressField) {
        addressField.addEventListener('input', function() {
            validateField(this, 'addressCheck');
        });
    }
    
    if (prefectureField) {
        prefectureField.addEventListener('change', function() {
            validateField(this, 'addressCheck');
        });
    }
}

function validateField(field, checkId) {
    const isValid = field.value.trim().length > 0;
    
    if (isValid) {
        field.classList.add('valid');
        field.classList.remove('invalid');
    } else {
        field.classList.remove('valid');
        field.classList.add('invalid');
    }
    
    checkEssentialFields();
}

function validatePhoneNumber(field) {
    const phoneRegex = /^[\d\-\(\)\+\s]{10,15}$/;
    const isValid = phoneRegex.test(field.value.trim());
    
    if (isValid) {
        field.classList.add('valid');
        field.classList.remove('invalid');
    } else {
        field.classList.remove('valid');
        if (field.value.trim().length > 0) {
            field.classList.add('invalid');
        }
    }
    
    checkEssentialFields();
}

function checkEssentialFields() {
    const checks = {
        name: checkNameComplete(),
        phone: checkPhoneComplete(),
        birth: checkBirthComplete(),
        address: checkAddressComplete()
    };
    
    updateCheckMark('nameCheck', checks.name);
    updateCheckMark('phoneCheck', checks.phone);
    updateCheckMark('birthCheck', checks.birth);
    updateCheckMark('addressCheck', checks.address);
    
    updateGroupStatus('name', checks.name);
    updateGroupStatus('phone', checks.phone);
    updateGroupStatus('birth', checks.birth);
    updateGroupStatus('address', checks.address);
    
    updateProgressBar(checks);
}

function checkNameComplete() {
    const lastName = document.getElementById('lastName')?.value.trim() || '';
    const firstName = document.getElementById('firstName')?.value.trim() || '';
    return lastName.length > 0 && firstName.length > 0;
}

function checkPhoneComplete() {
    const phone = document.getElementById('phone')?.value.trim() || '';
    const phoneRegex = /^[\d\-\(\)\+\s]{10,15}$/;
    return phoneRegex.test(phone);
}

function checkBirthComplete() {
    const year = document.getElementById('birthYear')?.value;
    const month = document.getElementById('birthMonth')?.value;
    const day = document.getElementById('birthDay')?.value;
    return year && month && day;
}

function checkAddressComplete() {
    const prefecture = document.getElementById('prefecture')?.value.trim() || '';
    const address = document.getElementById('address')?.value.trim() || '';
    return prefecture.length > 0 && address.length > 0;
}

function updateCheckMark(checkId, isComplete) {
    const checkMark = document.getElementById(checkId);
    if (checkMark) {
        if (isComplete) {
            checkMark.classList.add('visible');
        } else {
            checkMark.classList.remove('visible');
        }
    }
}

function updateGroupStatus(groupType, isComplete) {
    const groups = document.querySelectorAll('.essential-group');
    
    groups.forEach((group, index) => {
        const groupTypes = ['name', 'phone', 'birth', 'address'];
        if (groupTypes[index] === groupType) {
            if (isComplete) {
                group.classList.add('completed');
            } else {
                group.classList.remove('completed');
            }
        }
    });
}

function updateProgressBar(checks) {
    const completedCount = Object.values(checks).filter(Boolean).length;
    const totalCount = 4;
    const percentage = (completedCount / totalCount) * 100;
    
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    
    if (progressFill) {
        progressFill.style.width = percentage + '%';
    }
    
    if (progressText) {
        progressText.textContent = `${completedCount}/${totalCount}`;
    }
    
    if (completedCount === totalCount) {
        showStatusMessage('âœ… å¿…é ˆé …ç›®ã®å…¥åŠ›ãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');
    }
}

// ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒãƒã‚§ãƒƒã‚¯
function isInSandbox() {
    try {
        localStorage.setItem('test', 'test');
        localStorage.removeItem('test');
        return false;
    } catch (e) {
        return true;
    }
}

// =============================================================================
// ä½æ‰€æ¤œç´¢æ©Ÿèƒ½ï¼ˆä»£æ›¿æ–¹æ³•ã‚’å«ã‚€ï¼‰
// =============================================================================

function lookupAddress() {
    const postalCode = document.getElementById('postalCode')?.value.trim();
    
    if (!postalCode) {
        showStatusMessage('éƒµä¾¿ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'info');
        return;
    }
    
    const cleanPostalCode = postalCode.replace(/[^0-9]/g, '');
    
    if (cleanPostalCode.length !== 7) {
        showStatusMessage('æ­£ã—ã„éƒµä¾¿ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š123-4567ï¼‰', 'error');
        return;
    }
    
    showStatusMessage('ä½æ‰€ã‚’æ¤œç´¢ä¸­...', 'info');
    
    // éƒµä¾¿ç•ªå·APIï¼ˆãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã¾ãŸã¯ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ã¿å‹•ä½œï¼‰
    const apiUrl = `https://zipcloud.ibsnet.co.jp/api/search?zipcode=${cleanPostalCode}`;
    
    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            if (data.results && data.results.length > 0) {
                const result = data.results[0];
                
                const prefectureSelect = document.getElementById('prefecture');
                if (prefectureSelect) {
                    prefectureSelect.value = result.address1;
                }
                
                const addressField = document.getElementById('address');
                if (addressField) {
                    addressField.value = result.address2 + result.address3;
                    addressField.focus();
                }
                
                showStatusMessage('âœ… ä½æ‰€ã‚’è‡ªå‹•å…¥åŠ›ã—ã¾ã—ãŸ', 'success');
                checkEssentialFields();
            } else {
                showStatusMessage('âŒ ä½æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'error');
            }
        })
        .catch(error => {
            console.error('ä½æ‰€æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
            // ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒã§ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            showStatusMessage('âŒ ä½æ‰€æ¤œç´¢æ©Ÿèƒ½ã¯ç¾åœ¨åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚æ‰‹å‹•ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
            
            // éƒµä¾¿ç•ªå·ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
            const prefectureSelect = document.getElementById('prefecture');
            if (prefectureSelect) {
                prefectureSelect.focus();
            }
        });
}

// =============================================================================
// ãƒ•ãƒªã‚¬ãƒŠè‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½
// =============================================================================

function setupKanaAutoGeneration() {
    let kanaTimeout;
    
    const lastNameField = document.getElementById('lastName');
    const firstNameField = document.getElementById('firstName');
    
    if (lastNameField) {
        lastNameField.addEventListener('input', function() {
            clearTimeout(kanaTimeout);
            kanaTimeout = setTimeout(() => {
                generateKana(this.value, 'lastNameKana');
            }, 1000);
        });
    }
    
    if (firstNameField) {
        firstNameField.addEventListener('input', function() {
            clearTimeout(kanaTimeout);
            kanaTimeout = setTimeout(() => {
                generateKana(this.value, 'firstNameKana');
            }, 1000);
        });
    }
}

function generateKana(name, targetId) {
    const kanaMap = {
        'ç”°': 'ãƒ€', 'ä¸­': 'ãƒŠã‚«', 'å±±': 'ãƒ¤ãƒ', 'ä½': 'ã‚µ', 'è—¤': 'ãƒˆã‚¦',
        'å¤ª': 'ã‚¿', 'éƒ': 'ãƒ­ã‚¦', 'èŠ±': 'ãƒãƒŠ', 'å­': 'ã‚³', 'ç¾': 'ãƒŸ',
        'å’Œ': 'ãƒ¯', 'é›„': 'ã‚ª', 'æ˜': 'ã‚¢ã‚­', 'åš': 'ãƒ’ãƒ­', 'å¥': 'ã‚±ãƒ³'
    };
    
    const targetField = document.getElementById(targetId);
    if (!targetField || targetField.value.trim() !== '') return;
    
    let kana = '';
    for (let char of name) {
        kana += kanaMap[char] || char;
    }
    
    if (kana !== name) {
        targetField.value = kana;
    }
}

// =============================================================================
// ãƒ‡ãƒ¼ã‚¿åé›†æ©Ÿèƒ½
// =============================================================================

function collectFormData() {
    updateBirthDateField();
    
    const formData = {};
    
    const orderNumberElement = document.getElementById('orderNumber');
    const currentDateElement = document.getElementById('currentDate');
    
    formData.orderNumber = orderNumberElement ? orderNumberElement.textContent : '';
    formData.orderDate = currentDateElement ? currentDateElement.textContent : '';
    formData.lastName = document.getElementById('lastName')?.value || '';
    formData.firstName = document.getElementById('firstName')?.value || '';
    formData.lastNameKana = document.getElementById('lastNameKana')?.value || '';
    formData.firstNameKana = document.getElementById('firstNameKana')?.value || '';
    formData.birthDate = document.getElementById('birthDate')?.value || '';
    formData.gender = document.getElementById('gender')?.value || '';
    formData.occupation = document.getElementById('occupation')?.value || '';
    
    formData.postalCode = document.getElementById('postalCode')?.value || '';
    formData.prefecture = document.getElementById('prefecture')?.value || '';
    formData.address = document.getElementById('address')?.value || '';
    formData.phone = document.getElementById('phone')?.value || '';
    formData.email = document.getElementById('email')?.value || '';
    formData.lineId = document.getElementById('lineId')?.value || '';
    formData.referrer = document.getElementById('referrer')?.value || '';
    
    formData.measurements = {
        height: document.getElementById('height')?.value || '',
        weight: document.getElementById('weight')?.value || '',
        chest: document.getElementById('chest')?.value || '',
        waist: document.getElementById('waist')?.value || '',
        hip: document.getElementById('hip')?.value || '',
        shoulderWidth: document.getElementById('shoulderWidth')?.value || '',
        jacketLength: document.getElementById('jacketLength')?.value || '',
        neckSize: document.getElementById('neckSize')?.value || '',
        armLengthLeft: document.getElementById('armLengthLeft')?.value || '',
        armLengthRight: document.getElementById('armLengthRight')?.value || '',
        yokoLength: document.getElementById('yokoLength')?.value || '',
        armHole: document.getElementById('armHole')?.value || '',
        upperArmCircum: document.getElementById('upperArmCircum')?.value || '',
        elbowCircum: document.getElementById('elbowCircum')?.value || '',
        wristCircum: document.getElementById('wristCircum')?.value || '',
        vestLength: document.getElementById('vestLength')?.value || '',
        pantWaist: document.getElementById('pantWaist')?.value || '',
        crotchDepth: document.getElementById('crotchDepth')?.value || '',
        inseam: document.getElementById('inseam')?.value || '',
        thighCircum: document.getElementById('thighCircum')?.value || '',
        kneeCircum: document.getElementById('kneeCircum')?.value || '',
        calfCircum: document.getElementById('calfCircum')?.value || '',
        shoulderSlopeLeft: document.getElementById('shoulderSlopeLeft')?.value || '',
        shoulderSlopeRight: document.getElementById('shoulderSlopeRight')?.value || '',
        kamaDepth: document.getElementById('kamaDepth')?.value || '',
        strapLength: document.getElementById('strapLength')?.value || '',
        overShoulderLength: document.getElementById('overShoulderLength')?.value || '',
        bodyType: document.getElementById('bodyType')?.value || ''
    };
    
    formData.items = [];
    const items = document.querySelectorAll('.style-item');
    items.forEach(item => {
        const itemId = item.getAttribute('data-item');
        
        const options = [];
        const checkboxes = item.querySelectorAll('input[type="checkbox"]:checked');
        checkboxes.forEach(checkbox => {
            const label = checkbox.nextElementSibling;
            if (label) {
                options.push(label.textContent);
            }
        });
        
        const itemData = {
            id: itemId,
            itemType: document.getElementById(`itemType_${itemId}`)?.value || '',
            fabric: document.getElementById(`fabric_${itemId}`)?.value || '',
            color: document.getElementById(`color_${itemId}`)?.value || '',
            jacketStyle: document.getElementById(`jacketStyle_${itemId}`)?.value || '',
            lining: document.getElementById(`lining_${itemId}`)?.value || '',
            buttons: document.getElementById(`buttons_${itemId}`)?.value || '',
            lapelStyle: document.getElementById(`lapelStyle_${itemId}`)?.value || '',
            cuffStyle: document.getElementById(`cuffStyle_${itemId}`)?.value || '',
            cuffDetails: document.getElementById(`cuffDetails_${itemId}`)?.value || '',
            options: options,
            price: parseInt(document.getElementById(`price_${itemId}`)?.value) || 0,
            deliveryDate: document.getElementById(`deliveryDate_${itemId}`)?.value || '',
            notes: document.getElementById(`notes_${itemId}`)?.value || ''
        };
        formData.items.push(itemData);
    });
    
    formData.payment = {
        method: document.getElementById('paymentMethod')?.value || '',
        deposit: parseInt(document.getElementById('deposit')?.value) || 0,
        balance: parseInt(document.getElementById('balance')?.value) || 0,
        orderDate: document.getElementById('orderDate')?.value || '',
        fittingDate: document.getElementById('fittingDate')?.value || '',
        completionDate: document.getElementById('completionDate')?.value || ''
    };
    
    const grandTotalElement = document.getElementById('grandTotal');
    const totalText = grandTotalElement ? grandTotalElement.textContent : 'Â¥0';
    formData.totalPrice = parseInt(totalText.replace(/[Â¥,]/g, '')) || 0;
    
    formData.generalNotes = document.getElementById('generalNotes')?.value || '';
    formData.timestamp = new Date().toISOString();
    
    return formData;
}

// =============================================================================
// å®Ÿç”¨çš„ãªä¿å­˜æ©Ÿèƒ½
// =============================================================================

// PDFä¿å­˜ï¼ˆHTMLã‚’PDFåŒ–ï¼‰
function saveToPDF() {
    try {
        showStatusMessage('PDFä¿å­˜ç”»é¢ã‚’é–‹ã„ã¦ã„ã¾ã™...', 'info');
        
        // å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’é–‹ãï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®PDFä¿å­˜æ©Ÿèƒ½ã‚’åˆ©ç”¨ï¼‰
        window.print();
        
        showStatusMessage('å°åˆ·ç”»é¢ã§ã€ŒPDFã¨ã—ã¦ä¿å­˜ã€ã‚’é¸æŠã—ã¦ãã ã•ã„', 'info');
    } catch (error) {
        console.error('PDFä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        showStatusMessage('âŒ PDFä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
    }
}

// Excelå½¢å¼ï¼ˆCSVï¼‰ã§ä¿å­˜ - Excelã§é–‹ã‘ã‚‹å½¢å¼
function saveToExcel() {
    try {
        const formData = collectFormData();
        const now = new Date();
        const dateStr = now.getFullYear() + 
                       String(now.getMonth() + 1).padStart(2, '0') + 
                       String(now.getDate()).padStart(2, '0');
        
        // Excelç”¨ã®è¦‹ã‚„ã™ã„å½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢
        const rows = [];
        
        // ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±
        rows.push(['ã‚ªãƒ¼ãƒ€ãƒ¼ã‚·ãƒ¼ãƒˆ']);
        rows.push([]);
        rows.push(['ä½œæˆæ—¥æ™‚', new Date().toLocaleString('ja-JP')]);
        rows.push(['æ³¨æ–‡ç•ªå·', formData.orderNumber]);
        rows.push([]);
        
        // ãŠå®¢æ§˜æƒ…å ±
        rows.push(['ã€ãŠå®¢æ§˜æƒ…å ±ã€‘']);
        rows.push(['ãŠåå‰', formData.lastName + ' ' + formData.firstName]);
        rows.push(['ãƒ•ãƒªã‚¬ãƒŠ', formData.lastNameKana + ' ' + formData.firstNameKana]);
        rows.push(['ç”Ÿå¹´æœˆæ—¥', formData.birthDate]);
        rows.push(['é›»è©±ç•ªå·', formData.phone]);
        rows.push(['ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', formData.email || '']);
        rows.push(['éƒµä¾¿ç•ªå·', formData.postalCode || '']);
        rows.push(['ä½æ‰€', formData.prefecture + formData.address]);
        rows.push([]);
        
        // æ¡å¯¸æƒ…å ±
        rows.push(['ã€æ¡å¯¸æƒ…å ±ã€‘']);
        if (formData.measurements.height) rows.push(['èº«é•·', formData.measurements.height + 'cm']);
        if (formData.measurements.weight) rows.push(['ä½“é‡', formData.measurements.weight + 'kg']);
        if (formData.measurements.chest) rows.push(['èƒ¸å›²', formData.measurements.chest + 'cm']);
        if (formData.measurements.waist) rows.push(['ã‚¦ã‚¨ã‚¹ãƒˆ', formData.measurements.waist + 'cm']);
        if (formData.measurements.hip) rows.push(['ãƒ’ãƒƒãƒ—', formData.measurements.hip + 'cm']);
        if (formData.measurements.shoulderWidth) rows.push(['è‚©å¹…', formData.measurements.shoulderWidth + 'cm']);
        rows.push([]);
        
        // ã‚ªãƒ¼ãƒ€ãƒ¼å†…å®¹
        rows.push(['ã€ã‚ªãƒ¼ãƒ€ãƒ¼å†…å®¹ã€‘']);
        formData.items.forEach((item, index) => {
            rows.push([`ã‚¢ã‚¤ãƒ†ãƒ ${index + 1}`]);
            rows.push(['ã‚¿ã‚¤ãƒ—', item.itemType || '']);
            rows.push(['ç”Ÿåœ°', item.fabric || '']);
            rows.push(['è‰²', item.color || '']);
            rows.push(['ä¾¡æ ¼', 'Â¥' + (item.price || 0).toLocaleString()]);
            rows.push(['ç´æœŸ', item.deliveryDate || '']);
            rows.push([]);
        });
        
        // ç·è¨ˆ
        rows.push(['ã€ãŠæ”¯æ‰•ã„æƒ…å ±ã€‘']);
        rows.push(['ç·è¨ˆ', 'Â¥' + formData.totalPrice.toLocaleString()]);
        rows.push(['ãŠæ”¯æ‰•ã„æ–¹æ³•', formData.payment.method || '']);
        rows.push(['å†…é‡‘', 'Â¥' + (formData.payment.deposit || 0).toLocaleString()]);
        rows.push(['æ®‹é‡‘', 'Â¥' + (formData.payment.balance || 0).toLocaleString()]);
        
        // CSVã«å¤‰æ›ï¼ˆExcelå¯¾å¿œï¼‰
        const csvContent = rows.map(row => 
            row.map(cell => {
                const str = String(cell || '');
                // ã‚«ãƒ³ãƒã‚„æ”¹è¡Œã‚’å«ã‚€å ´åˆã¯ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚€
                if (str.includes(',') || str.includes('\n') || str.includes('"')) {
                    return '"' + str.replace(/"/g, '""') + '"';
                }
                return str;
            }).join(',')
        ).join('\n');
        
        // BOMã‚’è¿½åŠ ï¼ˆExcelæ–‡å­—åŒ–ã‘å¯¾ç­–ï¼‰
        const bom = '\uFEFF';
        const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8' });
        
        const customerName = (formData.lastName + formData.firstName) || 'ãŠå®¢æ§˜';
        const filename = `ã‚ªãƒ¼ãƒ€ãƒ¼ã‚·ãƒ¼ãƒˆ_${customerName}_${dateStr}.csv`;
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showStatusMessage(`âœ… Excelãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸ: ${filename}`, 'success');
        
    } catch (error) {
        console.error('Excelä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        showStatusMessage('âŒ Excelä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
    }
}

// ãƒ‡ãƒ¼ã‚¿ç®¡ç†ç”¨CSVä¿å­˜ï¼ˆCRMé¡§å®¢ãƒã‚¹ã‚¿ãƒ¼å¯¾å¿œç‰ˆï¼‰
function saveToCSV() {
    try {
        const formData = collectFormData();
        
        // Google Sheetsé¡§å®¢ãƒã‚¹ã‚¿ãƒ¼ã®åˆ—é †ã«åˆã‚ã›ãŸãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±ã‚’æ‹¡å¼µï¼‰
        const headers = [
            'é¡§å®¢ID', 'å§“', 'å', 'ãƒ•ãƒªã‚¬ãƒŠï¼ˆå§“ï¼‰', 'ãƒ•ãƒªã‚¬ãƒŠï¼ˆåï¼‰', 'ç”Ÿå¹´æœˆæ—¥', 'æ€§åˆ¥', 'è·æ¥­',
            'éƒµä¾¿ç•ªå·', 'éƒ½é“åºœçœŒ', 'ä½æ‰€', 'é›»è©±ç•ªå·', 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', 'LINE_ID', 'ç´¹ä»‹è€…',
            'èº«é•·', 'ä½“é‡', 'èƒ¸å›²', 'ã‚¦ã‚¨ã‚¹ãƒˆ', 'ãƒ’ãƒƒãƒ—', 'è‚©å¹…', 'ä¸Šç€ä¸ˆ', 'é¦–å›ã‚Š',
            'è¢–ä¸ˆå·¦', 'è¢–ä¸ˆå³', 'è£„ä¸ˆ', 'AH', 'äºŒã®è…•å‘¨ã‚Š', 'è‚˜å‘¨ã‚Š', 'æ‰‹é¦–å‘¨ã‚Š',
            'ãƒ™ã‚¹ãƒˆä¸ˆ', 'ãƒ‘ãƒ³ãƒ„ã‚¦ã‚¨ã‚¹ãƒˆ', 'è‚¡ä¸Š', 'è‚¡ä¸‹', 'å¤ªã‚‚ã‚‚å‘¨ã‚Š', 'è†å‘¨ã‚Š', 'ãµãã‚‰ã¯ãå‘¨ã‚Š',
            'è‚©å‚¾æ–œå·¦', 'è‚©å‚¾æ–œå³', 'éŒæ·±', 'ã‚¹ãƒˆãƒ©ãƒƒãƒ—å¯¸', 'ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼å¯¸',
            'ã‚¢ã‚¤ãƒ†ãƒ No', 'ã‚¢ã‚¤ãƒ†ãƒ ã‚¿ã‚¤ãƒ—', 'ç”Ÿåœ°', 'è‰²', 'ã‚¸ãƒ£ã‚±ãƒƒãƒˆã‚¹ã‚¿ã‚¤ãƒ«', 'è£åœ°', 'ãƒœã‚¿ãƒ³',
            'è¡¿å‹', 'ã‚«ãƒ•ã‚¹', 'ã‚«ãƒ•ã‚¹è©³ç´°', 'ã‚ªãƒ—ã‚·ãƒ§ãƒ³', 'ä¾¡æ ¼', 'ç´æœŸ', 'ã‚¢ã‚¤ãƒ†ãƒ å‚™è€ƒ',
            'ç·é¡', 'æ”¯æ‰•æ–¹æ³•', 'å†…é‡‘', 'æ®‹é‡‘', 'å…¨ä½“å‚™è€ƒ', 'å—æ³¨æ—¥', 'æ³¨æ–‡ç•ªå·'
        ];
        
        // è¤‡æ•°ã‚¢ã‚¤ãƒ†ãƒ ã‚’å„è¡Œã«å±•é–‹ã™ã‚‹ãŸã‚ã®é…åˆ—
        const rows = [];
        
        // ã‚¢ã‚¤ãƒ†ãƒ ãŒãªã„å ´åˆã§ã‚‚æœ€ä½1è¡Œã¯å‡ºåŠ›
        if (formData.items.length === 0) {
            formData.items.push({});
        }
        
        // å„ã‚¢ã‚¤ãƒ†ãƒ ã”ã¨ã«è¡Œã‚’ä½œæˆ
        formData.items.forEach((item, index) => {
            const values = [
                formData.orderNumber, // é¡§å®¢ID
                formData.lastName,
                formData.firstName,
                formData.lastNameKana,
                formData.firstNameKana,
                formData.birthDate,
                formData.gender === 'male' ? 'ç”·æ€§' : formData.gender === 'female' ? 'å¥³æ€§' : formData.gender,
                formData.occupation,
                formData.postalCode,
                formData.prefecture,
                formData.address,
                formData.phone,
                formData.email,
                formData.lineId,
                formData.referrer,
                formData.measurements.height,
                formData.measurements.weight,
                formData.measurements.chest,
                formData.measurements.waist,
                formData.measurements.hip,
                formData.measurements.shoulderWidth,
                formData.measurements.jacketLength,
                formData.measurements.neckSize,
                formData.measurements.armLengthLeft,
                formData.measurements.armLengthRight,
                formData.measurements.yokoLength,
                formData.measurements.armHole,
                formData.measurements.upperArmCircum,
                formData.measurements.elbowCircum,
                formData.measurements.wristCircum,
                formData.measurements.vestLength,
                formData.measurements.pantWaist,
                formData.measurements.crotchDepth,
                formData.measurements.inseam,
                formData.measurements.thighCircum,
                formData.measurements.kneeCircum,
                formData.measurements.calfCircum,
                formData.measurements.shoulderSlopeLeft || '',
                formData.measurements.shoulderSlopeRight || '',
                formData.measurements.kamaDepth || '',
                formData.measurements.strapLength || '',
                formData.measurements.overShoulderLength || '',
                // ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±
                index + 1, // ã‚¢ã‚¤ãƒ†ãƒ No
                item.itemType || '',
                item.fabric || '',
                item.color || '',
                item.jacketStyle === 'single' ? 'ã‚·ãƒ³ã‚°ãƒ«' : item.jacketStyle === 'double' ? 'ãƒ€ãƒ–ãƒ«' : item.jacketStyle || '',
                item.lining || '',
                item.buttons || '',
                item.lapelStyle || '',
                item.cuffStyle || '',
                item.cuffDetails || '',
                item.options ? item.options.join('ã€') : '', // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§çµåˆ
                item.price || '',
                item.deliveryDate || '',
                item.notes || '',
                // æ”¯æ‰•ã„æƒ…å ±ï¼ˆå…¨è¡Œã§åŒã˜ï¼‰
                formData.totalPrice,
                formData.payment.method === 'cash' ? 'ç¾é‡‘' : 
                formData.payment.method === 'card' ? 'ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰' : 
                formData.payment.method === 'transfer' ? 'éŠ€è¡ŒæŒ¯è¾¼' : 
                formData.payment.method === 'installment' ? 'åˆ†å‰²æ‰•ã„' : formData.payment.method,
                formData.payment.deposit,
                formData.payment.balance,
                formData.generalNotes,
                formData.orderDate, // ç¾åœ¨ã®æ—¥ä»˜
                formData.orderNumber // æ³¨æ–‡ç•ªå·
            ];
            
            rows.push(values);
        });
        
        // CSVä½œæˆ
        const csvContent = [
            headers.join(','),
            ...rows.map(row => 
                row.map(v => {
                    const str = String(v || '');
                    // æ•°å€¤ã®å ´åˆã¯ãã®ã¾ã¾ã€æ–‡å­—åˆ—ã®å ´åˆã¯å¿…è¦ã«å¿œã˜ã¦ã‚¯ã‚©ãƒ¼ãƒˆ
                    if (!isNaN(str) && str !== '') {
                        return str;
                    }
                    // ã‚«ãƒ³ãƒã€æ”¹è¡Œã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã‚’å«ã‚€å ´åˆã¯ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚€
                    if (str.includes(',') || str.includes('\n') || str.includes('"')) {
                        return `"${str.replace(/"/g, '""')}"`;
                    }
                    return str;
                }).join(',')
            )
        ].join('\n');
        
        const bom = '\uFEFF';
        const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8' });
        
        const now = new Date();
        const dateStr = now.getFullYear() + 
                       String(now.getMonth() + 1).padStart(2, '0') + 
                       String(now.getDate()).padStart(2, '0');
        
        const customerName = (formData.lastName + formData.firstName) || 'ãƒ‡ãƒ¼ã‚¿';
        const filename = `CRMé¡§å®¢ãƒ‡ãƒ¼ã‚¿_${customerName}_${dateStr}.csv`;
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showStatusMessage(`âœ… CRMé¡§å®¢ãƒã‚¹ã‚¿ãƒ¼ç”¨CSVã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸ: ${filename}`, 'success');
        
    } catch (error) {
        console.error('CSVä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        showStatusMessage('âŒ CSVä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
    }
}

// ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿å­˜ï¼ˆå…¥åŠ›é€”ä¸­ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼‰
function saveBackupData() {
    if (isInSandbox()) {
        showStatusMessage('âš ï¸ ã“ã®ç’°å¢ƒã§ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'info');
        return;
    }
    
    try {
        const formData = collectFormData();
        
        // ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        localStorage.setItem('orderSheetBackup', JSON.stringify(formData));
        localStorage.setItem('orderSheetBackupDate', new Date().toISOString());
        
        showStatusMessage('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚ä¿æŒã•ã‚Œã¾ã™ã€‚', 'success');
        
    } catch (error) {
        console.error('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);
        showStatusMessage('âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
    }
}

// ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—èª­ã¿è¾¼ã¿
function loadBackupData() {
    if (isInSandbox()) {
        showStatusMessage('âš ï¸ ã“ã®ç’°å¢ƒã§ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'info');
        return;
    }
    
    try {
        const backupData = localStorage.getItem('orderSheetBackup');
        const backupDate = localStorage.getItem('orderSheetBackupDate');
        
        if (!backupData) {
            showStatusMessage('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'info');
            return;
        }
        
        const data = JSON.parse(backupData);
        const date = new Date(backupDate);
        const dateStr = date.toLocaleString('ja-JP');
        
        if (confirm(`${dateStr} ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ\nç¾åœ¨ã®å…¥åŠ›å†…å®¹ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚`)) {
            loadDataToForm(data);
            showStatusMessage(`âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ${dateStr}ï¼‰`, 'success');
        }
        
    } catch (error) {
        console.error('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        showStatusMessage('âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
    }
}

// è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ï¼ˆ5åˆ†ã”ã¨ï¼‰
function setupAutoBackup() {
    if (isInSandbox()) {
        console.log('ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒã§ã¯è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“');
        return;
    }
    
    setInterval(() => {
        const lastName = document.getElementById('lastName')?.value;
        const firstName = document.getElementById('firstName')?.value;
        
        // åå‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
        if (lastName || firstName) {
            try {
                saveBackupData();
                console.log('è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†:', new Date().toLocaleString());
            } catch (e) {
                console.log('è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', e);
            }
        }
    }, 5 * 60 * 1000); // 5åˆ†ã”ã¨
}

function loadDataToForm(data) {
    try {
        if (data.lastName) document.getElementById('lastName').value = data.lastName;
        if (data.firstName) document.getElementById('firstName').value = data.firstName;
        if (data.phone) document.getElementById('phone').value = data.phone;
        if (data.email) document.getElementById('email').value = data.email;
        if (data.address) document.getElementById('address').value = data.address;
        
        if (data.measurements) {
            Object.keys(data.measurements).forEach(key => {
                const element = document.getElementById(key);
                if (element && data.measurements[key]) {
                    element.value = data.measurements[key];
                }
            });
        }
        
        if (data.items && data.items.length > 0) {
            const firstItem = data.items[0];
            if (firstItem.itemType) {
                const itemTypeElement = document.getElementById('itemType_1');
                if (itemTypeElement) itemTypeElement.value = firstItem.itemType;
            }
            if (firstItem.fabric) {
                const fabricElement = document.getElementById('fabric_1');
                if (fabricElement) fabricElement.value = firstItem.fabric;
            }
            if (firstItem.price) {
                const priceElement = document.getElementById('price_1');
                if (priceElement) priceElement.value = firstItem.price;
            }
            if (firstItem.lapelStyle) {
                const lapelElement = document.getElementById('lapelStyle_1');
                if (lapelElement) lapelElement.value = firstItem.lapelStyle;
            }
            if (firstItem.cuffStyle) {
                const cuffElement = document.getElementById('cuffStyle_1');
                if (cuffElement) cuffElement.value = firstItem.cuffStyle;
            }
        }
        
        updateTotalPrice();
        checkEssentialFields();
        
    } catch (error) {
        console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
}

// =============================================================================
// ã‚¹ã‚¿ã‚¤ãƒ«ã‚¢ã‚¤ãƒ†ãƒ ç®¡ç†æ©Ÿèƒ½
// =============================================================================

function addStyleItem() {
    const container = document.getElementById('styleItemsContainer');
    if (!container) return;
    
    const itemId = nextItemId;
    
    const itemHTML = `
        <div class="style-item adding" data-item="${itemId}">
            <div class="item-header">
                <h5>ã‚¢ã‚¤ãƒ†ãƒ  ${itemId}</h5>
                <button type="button" class="remove-item-btn" onclick="removeStyleItem(${itemId})">å‰Šé™¤</button>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="itemType_${itemId}">ã‚¢ã‚¤ãƒ†ãƒ ã‚¿ã‚¤ãƒ—</label>
                    <select id="itemType_${itemId}" name="itemType_${itemId}">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="Suit(2P)">Suit(2P)</option>
                        <option value="Suit(3P)">Suit(3P)</option>
                        <option value="Suit+Pants">Suit+Pants</option>
                        <option value="Suit(3P)+Pants">Suit(3P)+Pants</option>
                        <option value="Jacket(S)">Jacket(S)</option>
                        <option value="Jacket(D)">Jacket(D)</option>
                        <option value="Vest">Vest</option>
                        <option value="Pants">Pants</option>
                        <option value="D Suit">D Suit</option>
                        <option value="D Suit(3P)">D Suit(3P)</option>
                        <option value="D Suit+Pants">D Suit+Pants</option>
                        <option value="D Suit(3P)+Pants">D Suit(3P)+Pants</option>
                        <option value="Shirts">Shirts</option>
                        <option value="Tie">Tie</option>
                        <option value="Repair">Repair</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="fabric_${itemId}">ç”Ÿåœ°</label>
                    <input type="text" id="fabric_${itemId}" name="fabric_${itemId}" placeholder="ç”Ÿåœ°ç•ªå·ãƒ»åç§°">
                </div>
                <div class="form-group">
                    <label for="color_${itemId}">è‰²</label>
                    <input type="text" id="color_${itemId}" name="color_${itemId}">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="jacketStyle_${itemId}">ã‚¸ãƒ£ã‚±ãƒƒãƒˆã‚¹ã‚¿ã‚¤ãƒ«</label>
                    <select id="jacketStyle_${itemId}" name="jacketStyle_${itemId}">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="single">ã‚·ãƒ³ã‚°ãƒ«</option>
                        <option value="double">ãƒ€ãƒ–ãƒ«</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="lining_${itemId}">è£åœ°</label>
                    <input type="text" id="lining_${itemId}" name="lining_${itemId}" placeholder="è£åœ°ã®ç¨®é¡ãƒ»è‰²">
                </div>
                <div class="form-group">
                    <label for="buttons_${itemId}">ãƒœã‚¿ãƒ³</label>
                    <input type="text" id="buttons_${itemId}" name="buttons_${itemId}" placeholder="ãƒœã‚¿ãƒ³ã®ç¨®é¡ãƒ»æè³ª">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="lapelStyle_${itemId}">è¡¿å‹ï¼ˆãƒ©ãƒšãƒ«ãƒ»ã‚«ãƒ©ãƒ¼ï¼‰</label>
                    <select id="lapelStyle_${itemId}" name="lapelStyle_${itemId}">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <optgroup label="ã‚¸ãƒ£ã‚±ãƒƒãƒˆãƒ»ã‚¹ãƒ¼ãƒ„">
                            <option value="notched">ãƒãƒƒãƒãƒ‰ãƒ©ãƒšãƒ«ï¼ˆä¸€èˆ¬çš„ï¼‰</option>
                            <option value="peaked">ãƒ”ãƒ¼ã‚¯ãƒ‰ãƒ©ãƒšãƒ«ï¼ˆå‰£å…ˆï¼‰</option>
                            <option value="shawl">ã‚·ãƒ§ãƒ¼ãƒ«ã‚«ãƒ©ãƒ¼</option>
                            <option value="narrow">ãƒŠãƒ­ãƒ¼ãƒ©ãƒšãƒ«</option>
                            <option value="wide">ãƒ¯ã‚¤ãƒ‰ãƒ©ãƒšãƒ«</option>
                        </optgroup>
                        <optgroup label="ã‚·ãƒ£ãƒ„ã‚«ãƒ©ãƒ¼">
                            <option value="regular_collar">ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ã‚«ãƒ©ãƒ¼</option>
                            <option value="semi_wide_collar">ã‚»ãƒŸãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                            <option value="wide_collar">ãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                            <option value="horizontal_wide_collar">ãƒ›ãƒªã‚¾ãƒ³ã‚¿ãƒ«ãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                            <option value="round_collar">ãƒ©ã‚¦ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                            <option value="open_collar">ã‚ªãƒ¼ãƒ—ãƒ³ã‚«ãƒ©ãƒ¼</option>
                            <option value="stand_collar">ã‚¹ã‚¿ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                            <option value="wing_collar">ã‚¦ã‚£ãƒ³ã‚°ã‚«ãƒ©ãƒ¼</option>
                            <option value="short_regular_collar">ã‚·ãƒ§ãƒ¼ãƒˆãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ã‚«ãƒ©ãƒ¼</option>
                            <option value="short_semi_wide_collar">ã‚·ãƒ§ãƒ¼ãƒˆã‚»ãƒŸãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                            <option value="short_wide_collar">ã‚·ãƒ§ãƒ¼ãƒˆãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                            <option value="short_horizontal_wide_collar">ã‚·ãƒ§ãƒ¼ãƒˆãƒ›ãƒªã‚¾ãƒ³ã‚¿ãƒ«ãƒ¯ã‚¤ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                            <option value="short_round_collar">ã‚·ãƒ§ãƒ¼ãƒˆãƒ©ã‚¦ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group">
                    <label for="cuffStyle_${itemId}">ã‚«ãƒ•ã‚¹ï¼ˆè¢–å£ï¼‰</label>
                    <select id="cuffStyle_${itemId}" name="cuffStyle_${itemId}">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <optgroup label="ã‚¸ãƒ£ã‚±ãƒƒãƒˆãƒ»ã‚¹ãƒ¼ãƒ„">
                            <option value="4button">4ã¤ãƒœã‚¿ãƒ³æœ¬åˆ‡ç¾½</option>
                            <option value="3button">3ã¤ãƒœã‚¿ãƒ³æœ¬åˆ‡ç¾½</option>
                            <option value="4button_fake">4ã¤ãƒœã‚¿ãƒ³ï¼ˆé£¾ã‚Šï¼‰</option>
                            <option value="3button_fake">3ã¤ãƒœã‚¿ãƒ³ï¼ˆé£¾ã‚Šï¼‰</option>
                            <option value="surgeons">ã‚µãƒ¼ã‚¸ãƒ£ãƒ³ã‚«ãƒ•ã‚¹</option>
                            <option value="kissing">ã‚­ãƒƒã‚·ãƒ³ã‚°ãƒœã‚¿ãƒ³</option>
                        </optgroup>
                        <optgroup label="ã‚·ãƒ£ãƒ„ã‚«ãƒ•ã‚¹">
                            <option value="regular_no_opening">ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ï¼ˆé–‹ããªã—ï¼‰</option>
                            <option value="small_round">å°ä¸¸</option>
                            <option value="round_b">ãƒ©ã‚¦ãƒ³ãƒ‰B</option>
                            <option value="round_c">ãƒ©ã‚¦ãƒ³ãƒ‰C</option>
                            <option value="cut_corner">è§’è½ã¡</option>
                            <option value="corn">ã‚³ãƒ¼ãƒ³</option>
                            <option value="turn_up">ã‚¿ãƒ¼ãƒ³ãƒŠãƒƒãƒ—</option>
                            <option value="double_cuff">ãƒ€ãƒ–ãƒ«</option>
                            <option value="arrow">ã‚¢ãƒ­ãƒ¼</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group">
                    <label for="cuffDetails_${itemId}">ã‚«ãƒ•ã‚¹è©³ç´°</label>
                    <input type="text" id="cuffDetails_${itemId}" name="cuffDetails_${itemId}" placeholder="ãƒœã‚¿ãƒ³ãƒ›ãƒ¼ãƒ«è‰²ã€ã‚¹ãƒ†ãƒƒãƒç­‰">
                </div>
            </div>
            
            <div class="form-group">
                <label>ã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="ticket_pocket_${itemId}" name="options_${itemId}">
                        <label for="ticket_pocket_${itemId}">ãƒã‚±ãƒƒãƒˆãƒã‚±ãƒƒãƒˆ</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="amf_stitch_${itemId}" name="options_${itemId}">
                        <label for="amf_stitch_${itemId}">AMFã‚¹ãƒ†ãƒƒãƒ</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="functional_sleeves_${itemId}" name="options_${itemId}">
                        <label for="functional_sleeves_${itemId}">æœ¬åˆ‡ç¾½</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="side_vents_${itemId}" name="options_${itemId}">
                        <label for="side_vents_${itemId}">ã‚µã‚¤ãƒ‰ãƒ™ãƒ³ãƒ„</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="suspender_buttons_${itemId}" name="options_${itemId}">
                        <label for="suspender_buttons_${itemId}">ã‚µã‚¹ãƒšãƒ³ãƒ€ãƒ¼ãƒœã‚¿ãƒ³</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="center_vent_${itemId}" name="options_${itemId}">
                        <label for="center_vent_${itemId}">ã‚»ãƒ³ã‚¿ãƒ¼ãƒ™ãƒ³ãƒ„</label>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="price_${itemId}">ä¾¡æ ¼ï¼ˆå††ï¼‰</label>
                    <input type="number" id="price_${itemId}" name="price_${itemId}" step="1000" onchange="updateTotalPrice()">
                </div>
                <div class="form-group">
                    <label for="deliveryDate_${itemId}">ç´æœŸ</label>
                    <input type="date" id="deliveryDate_${itemId}" name="deliveryDate_${itemId}">
                </div>
            </div>
            
            <div class="form-group">
                <label for="notes_${itemId}">å‚™è€ƒ</label>
                <textarea id="notes_${itemId}" name="notes_${itemId}" rows="2" placeholder="ç‰¹åˆ¥ãªè¦æœ›ã‚„æ³¨æ„äº‹é …"></textarea>
            </div>
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', itemHTML);
    itemCounter++;
    nextItemId++;
    
    setTimeout(() => {
        const newItem = container.querySelector(`[data-item="${itemId}"]`);
        if (newItem) {
            newItem.classList.remove('adding');
        }
    }, 300);
    
    updateItemCount();
    updateRemoveButtons();
}

function removeStyleItem(itemId) {
    const item = document.querySelector(`[data-item="${itemId}"]`);
    if (item && itemCounter > 1) {
        item.classList.add('removing');
        
        setTimeout(() => {
            item.remove();
            itemCounter--;
            updateItemCount();
            updateRemoveButtons();
            updateTotalPrice();
        }, 300);
    }
}

function updateItemCount() {
    const itemCountElement = document.getElementById('itemCount');
    if (itemCountElement) {
        itemCountElement.textContent = itemCounter;
    }
}

function updateRemoveButtons() {
    const removeButtons = document.querySelectorAll('.remove-item-btn');
    removeButtons.forEach(button => {
        if (itemCounter <= 1) {
            button.style.display = 'none';
        } else {
            button.style.display = 'inline-block';
        }
    });
}

// =============================================================================
// ä¾¡æ ¼è¨ˆç®—æ©Ÿèƒ½
// =============================================================================

function updateTotalPrice() {
    let total = 0;
    const breakdown = document.getElementById('priceBreakdown');
    if (breakdown) {
        breakdown.innerHTML = '';
    }

    const items = document.querySelectorAll('.style-item');
    items.forEach((item, index) => {
        const itemId = item.getAttribute('data-item');
        const priceInput = document.getElementById(`price_${itemId}`);
        const itemTypeSelect = document.getElementById(`itemType_${itemId}`);
        
        if (priceInput && priceInput.value) {
            const price = parseInt(priceInput.value) || 0;
            const itemType = itemTypeSelect ? itemTypeSelect.value || `ã‚¢ã‚¤ãƒ†ãƒ  ${itemId}` : `ã‚¢ã‚¤ãƒ†ãƒ  ${itemId}`;
            
            total += price;
            
            if (breakdown) {
                const row = document.createElement('div');
                row.className = 'total-row';
                row.innerHTML = `
                    <span>${itemType}</span>
                    <span>Â¥${price.toLocaleString()}</span>
                `;
                breakdown.appendChild(row);
            }
        }
    });

    const grandTotalElement = document.getElementById('grandTotal');
    if (grandTotalElement) {
        grandTotalElement.textContent = `Â¥${total.toLocaleString()}`;
    }
}

// =============================================================================
// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
// =============================================================================

window.addEventListener('online', function() {
    showStatusMessage('ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãŒå¾©æ—§ã—ã¾ã—ãŸ', 'success');
});

window.addEventListener('offline', function() {
    showStatusMessage('ğŸ“± ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã‚’ã”åˆ©ç”¨ãã ã•ã„', 'info');
});

window.addEventListener('beforeunload', function(e) {
    const lastName = document.getElementById('lastName')?.value;
    const firstName = document.getElementById('firstName')?.value;
    
    if (lastName || firstName) {
        e.preventDefault();
        e.returnValue = '';
    }
});

// =============================================================================
// ãƒ‡ãƒãƒƒã‚°ã¨ãƒ­ã‚°å‡ºåŠ›
// =============================================================================

console.log('=== CRMã‚ªãƒ¼ãƒ€ãƒ¼ã‚·ã‚¹ãƒ†ãƒ  V5 å®Œå…¨ç‰ˆ ===');
console.log('åˆæœŸåŒ–å®Œäº†æ™‚åˆ»:', new Date().toISOString());
console.log('åˆ©ç”¨å¯èƒ½æ©Ÿèƒ½:');
console.log('- è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆ5åˆ†ã”ã¨ï¼‰');
console.log('- PDF/Excel/CSVä¿å­˜');
console.log('- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ');
console.log('- ãƒ‡ãƒ¼ã‚¿ä¿è­·æ©Ÿèƒ½');
console.log('========================');
    </script>
</body>
</html>
